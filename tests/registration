from selenium import webdriver
from selenium.webdriver.common.by import By
from selenium.webdriver.support.wait import WebDriverWait
from selenium.webdriver.support import expected_conditions
import string
import random
import pytest

def generate_str(length):
    if length < 1 or length > 100:
        raise ValueError("Длина должна быть от 1 до 100 символов")
    else:
        characters = string.ascii_letters + string.digits
        str = ''.join(random.choice(characters) for i in range(length))
        return str


def generate_email(length):
    return f'{generate_str(length)}@ya.ru'




def test_registration_valid_credentials():
    name = generate_str(4)
    email = generate_email(10)
    password = generate_str(6)

    driver = webdriver.Chrome()
    driver.get("https://stellarburgers.nomoreparties.site/register")

    WebDriverWait(driver, 10).until(expected_conditions.element_to_be_clickable(
        (By.XPATH, "//button[text()='Зарегистрироваться']")))
    driver.find_element(
        By.XPATH, "//label[text()='Имя']/following-sibling::input[@type='text']").send_keys(name)
    driver.find_element(
        By.XPATH, "//label[text()='Email']/following-sibling::input[@type='text']").send_keys(email)
    driver.find_element(
        By.XPATH, "//label[text()='Пароль']/following-sibling::input[@type='password']").send_keys(password)
    driver.find_element(
        By.XPATH, "//button[text()='Зарегистрироваться']").click()

    WebDriverWait(driver, 10).until(expected_conditions.element_to_be_clickable(
        (By.XPATH, "//button[text()='Войти']")))
    driver.find_element(
        By.XPATH, "//label[text()='Email']/following-sibling::input[@type='text']").send_keys(email)
    driver.find_element(
        By.XPATH, "//label[text()='Пароль']/following-sibling::input[@type='password']").send_keys(password)
    driver.find_element(By.XPATH, "//button[text()='Войти']").click()

    button = WebDriverWait(driver, 10).until(expected_conditions.visibility_of_element_located(
        (By.XPATH, "//button[text()='Оформить заказ']")))
    assert button.text == "Оформить заказ"
    driver.quit()


def test_registration_with_too_short_password():
    name = generate_str(7)
    email = generate_email(10)
    password = generate_str(5)

    driver = webdriver.Chrome()
    driver.get("https://stellarburgers.nomoreparties.site/register")

    WebDriverWait(driver, 10).until(expected_conditions.element_to_be_clickable(
        (By.XPATH, "//button[text()='Зарегистрироваться']")))
    driver.find_element(
        By.XPATH, "//label[text()='Имя']/following-sibling::input[@type='text']").send_keys(name)
    driver.find_element(
        By.XPATH, "//label[text()='Email']/following-sibling::input[@type='text']").send_keys(email)
    driver.find_element(
        By.XPATH, "//label[text()='Пароль']/following-sibling::input[@type='password']").send_keys(password)
    driver.find_element(
        By.XPATH, "//button[text()='Зарегистрироваться']").click()

    error = WebDriverWait(driver, 10).until(
        expected_conditions.visibility_of_element_located((By.XPATH, "//p[@class='input__error']")))
    assert error.text == 'Некорректный пароль'
